dist: trusty

language: php

php:
    - 7.2
    - 7.3

addons:
    sonarcloud:
        organization: "nabu-3-github"

cache:
    directories:
        - $HOME/.composer
        - $HOME/.sonar
        - $HOME/.sonarscanner
        - $HOME/build/nabu-3/lexer/vendor

install:
    - travis_retry composer install

script:
    - git fetch --unshallow
    - git fetch --no-tags https://github.com/nabu-3/lexer.git +refs/heads/master:refs/remotes/origin/master
    - chmod a-r ./tests/nabu/lexer/resources/test-write-only-file.json
    - ./vendor/bin/phpunit
    - sonar-scanner
